<!DOCTYPE html>
<html>
<head>
	
	<title>ARC</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
<script src="https://www.domoritz.de/leaflet-locatecontrol/src/L.Control.Locate.js"> </script>

<script src="/cdn-cgi/apps/head/WCXTfKrGxLNzfpUe-D2TgHwMpm4.js"></script><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
<link rel="stylesheet" href="../dist/L.Control.Locate.min.css" />

<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />

<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>     


 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  
  <link href="https:/maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
  
  
  <script src="https://cdn.jsdelivr.net/npm/alasql@0.4"></script>
  <script src='L.Control.Bar.js'></script>
 
  
<style>
      html,
      body,
      #viewDiv {
	    position: fixed;
		top: 0px;
	   	padding: 0;
        margin: 0;
        height: 98%;
        width: 100vw;
      }
	   #choiceDiv {
	 visibility: hidden;
      position: absolute;
      top: 25%;
      width: 100%;
      padding: 20px ;
      z-index: 1;
      text-align: center;
    }
	
	.navbar{
	 z-index: 2;
	}
	.row {
	opacity: 0.8;
  visibility: hidden;
  bottom: 5%;
  left:0%;
  right:0%;
  z-index: 0;
  display:flex;
  position:fixed;

}
	
	.menu1{
	background-color:pink;
	z-index: 1;
	}
	

    .button {
      background: white;
      padding: 7px;
      border: 1px solid #005e95;
      font-size: 0.9em;
      margin: 5px;
      color: white;
      font-family: "Avenir Next W01", "Arial", sans-serif;
    }
	
	.button1
	{
	background-image: url("ARClogo.jpg");
	}
	
	.button2
	{
	background: red;
	border-radius: 50%;
	}
	
	.button3
	{
	background: orange;
    border-radius: 30%;
	}
	
	.button4
	{
	background: green;
	}
	
	.button1:hover {
      background: #005e95;
      color: white;
      cursor: pointer;
    }
	
	.button2:hover {
      background: #005e95;
      color: white;
      cursor: pointer;
    }
	
	.button3:hover {
      background: #005e95;
      color: white;
      cursor: pointer;
    }
	
	.button4:hover {
      background: #005e95;
      color: white;
      cursor: pointer;
    }
	
.scroll {
  white-space: nowrap; 
  overflow-x: auto; 
  -webkit-overflow-scrolling: touch; 
  -ms-overflow-style: -ms-autohiding-scrollbar; 
  }
  
  .scroll::-webkit-scrollbar {
  display: none; }
  
  	.column {
  float: left;
  padding:10px;
 

}

.left {
  width: 20%;
}

.right {
  width: 80%;
}

	
	div.image {
   content:url(trash2.jpg)
}​

h5
	{
  color: green;
}
	
a:hover {
  background-color: white;
}

.leaflet-control-container .leaflet-routing-container-hide {
    display: none;
}
	
.navsub {
    overflow-y:auto;
   overflow-x:hidden;
    max-height:60vh;
   min-width:40vw;
}

#poll2{

}	

.type
{
  position: absolute;
  top: -10px;
  right: -10px;
  padding: 5px 10px;
  border-radius: 50%;
  background: red;
  color: white;

}

.custom .leaflet-popup-tip,
.custom .leaflet-popup-content-wrapper {
    background-color: transparent;
    color:black;
}

.located
{
//border: 2px solid blue;
background-color:white;
}

.unlocated
{
//border: 2px solid gray;
background-color:white;
}

.containertype {
  border: 2px solid #dedede;
  border-radius: 5px;
  padding: 10px;
  margin: 10px 0;
  color:black; 
}

.pro {
  border-color: rgba(0, 191, 255, 1);
  background-color: transparent ;
}

.con {
  border-color: rgba(255, 20, 147, 1);
  background-color: transparent ;
}

.neutral{
  border-color: grey;
  background-color: transparent ;
}

.green{
 border-color:green;
   background-color: transparent ;
}
.popover
{
   background-color: transparent;
}

.modal.right .modal-dialog {
	//position:absolute;
	right:0;
}

.modal.left .modal-dialog {
	//position:absolute;
	left:0;

}

.center {
	position:absolute;
	bottom:0vh;
	top:60vh;
   left:0vw;
   right:0vw;
    
   

}

.up {
	position:absolute;
	top:2vh;
   left:15vw;
   right:15vw;
    
   

}

.overlay {
    position: absolute;
    z-index: 314159;
    pointer-events: auto;
	   overflow-y:auto;
}

.notoverlay {
    position: absolute;
    z-index: 314159;
}

.menu
{

}

.ftp{
position:fixed;
top:5vh;
}

#activate{
position:fixed;
top:60vw;
}

#properties{
position:fixed;
top:70vw;
}

</style>
	
</head>
<body>



<div id="viewDiv"  ></div>

<script>

//alert('ver 1.0Jenny');

var markers=[];
var customPopup;
 var customOptions;
var mymap;
var activemarker;
var actvmkr=[];
var newMarker;
var newMarkerCircle;



$(function(){
    
    $("[data-toggle=popover]").popover({
        html : true,
        content: function() {
            var content = $(this).attr("data-popover-content");
            return $(content).children(".popover-body").html();
        },
        title: function() {
            var title = $(this).attr("data-popover-content");
            return $(title).children(".popover-heading").html();
        }
    });});


var pos=[];
var surveyttl=[
'1. Are you involved in the emergency and how do you feel?',
"2. Can you label the emergency?",
"3. People involved and the most critical situation?",
'4. Are vehicules involved? Which types?',
'5. Are guns involved? Which types?',
"6. If medical problems what are symptoms?",
"7. What medications people involved are on?",
"8. Are they breathing?",
'9. If there is a fire, how big is the fire?' ]
var survey=[];





function Start()
{
document.getElementById("menu1").style.display="none";
if (document.getElementById("viewDiv").innerHTML)
{
document.getElementById("viewDiv").style.display="block";
}
else
{
   var orangeIcon = new L.Icon({
  iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});


	
	
		mymap = L.map('viewDiv',
	{center: [45, 3],
    zoom: 10});
	
	mymap.on('movestart', function(e) {
   document.getElementById('inboxxx').style.backgroundColor='transparent';
});
	
	mymap.on('moveend', function(e) {
  document.getElementById('inboxxx').style.backgroundColor='';
});

/*var controlBar = L.control.bar('bar',{
    position:'top',
    visible:true
});


mymap.addControl(controlBar);
	controlBar.show();*/
	

	//https://github.com/domoritz/leaflet-locatecontrol
	var geocoder = L.Control.Geocoder.nominatim(),
        control = L.Control.geocoder({
		position:'topright',
          geocoder: geocoder
        }).addTo(mymap),
		newCircle;
    
	
	
	
var pinpopup= L.popup();
var pinpopupcontent= 
"<div id='ppp'><form action='' > <input type='text' placeholder='Event name'></input></br><input type='text' placeholder='Center'></input><p id='adress' value='adress'></p></br><input type='text' placeholder='Invite'></input> <input type='submit'  value='Create event'></form></div> "



	mymap.doubleClickZoom.disable(); 
	
L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 20,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);
	
	




	
	
	 function GoInFullscreen(element) {
	// alert("Let's start");
	if(element.requestFullscreen)
		element.requestFullscreen();
	else if(element.mozRequestFullScreen)
		element.mozRequestFullScreen();
	else if(element.webkitRequestFullscreen)
		element.webkitRequestFullscreen();
	else if(element.msRequestFullscreen)
		element.msRequestFullscreen();
}
	
	mymap.locate({watch:true, maxZoom: 18});
	
	
	
	function onLocationFound(e) {

	if(pos.length==0)
	{
	
	customPopup="<div><h4>Distance: xxxx </h4><br><h4>Estimated arrival time: xxx </h4></div>"
	 customOptions=
        {
        'className' : 'custom located navsub',
				autoClose:false,
    closeOnClick:false
        };
	if (newCircle)
	     mymap.removeLayer(newCircle);
    var radius = e.accuracy / 2;
    newCircle= new L.circle(e.latlng, radius).addTo(mymap).bindPopup(customPopup,customOptions).openPopup();
	markers.push(newCircle);
	$('#inboxxx').modal('show');
	//document.getElementById('positiontext').innerHTML= '<span class="glyphicon glyphicon-record"></span> Your position is set'+ ' <button>hide</button>';
	document.getElementById('connectstatus').setAttribute('class',"glyphicon glyphicon-off");
	var d =document.getElementById('inboxxx');
d.className += " located";
	init();
	updateloc(0);
	
	}
	
	if(pos.length!=0 && (pos.latlng.lat!=e.latlng.lat || pos.latlng.lng!=e.latlng.lng) )
	{
	if(distanceInMBetweenEarthCoordinates(e.latlng.lat,e.latlng.lng,pos.latlng.lat,pos.latlng.lng)>10)
	{}
	//update marker and   marker.setPosition(e.latlng);
	
	}
	pos=e;
	
    }
	
	
	function onLocationError(e)
	{
	customPopup="<div><h4>Distance: xxxx </h4><br><h4>Estimated arrival time: xxx </h4></div>"
	customOptions=
        {
      //  'className' : 'custom unlocated navsub',
		'autoClose' : false,
        };
	if (newCircle)
	     mymap.removeLayer(newCircle);
	newCircle=new L.circle([21.31560,	-157.858093],20).addTo(mymap).bindPopup(customPopup,customOptions).openPopup();
	markers.push(newCircle);
	document.getElementById('inboxxx').style.display='block';
	//$('#inboxxx').modal('show'); modal
	//document.getElementById('positiontext').innerHTML='<span class="glyphicon glyphicon-warning-sign"></span> '+ e.message + ' <button onclick="location.reload()">retry</button>';
	document.getElementById('connectstatus').setAttribute('class',"glyphicon glyphicon-warning-sign");
	var d =document.getElementById('inboxxx');
d.className += " unlocated";
	init();
	}
    
    mymap.on('locationfound', onLocationFound);
	 mymap.on('locationerror', onLocationError);
	
	
	

    L.control.locate({
       locateOptions: {
               enableHighAccuracy: true,
			   maxZoom: 18
}}).addTo(mymap);	
	
	mymap.addControl(new L.Control.Fullscreen({
    title: {
        'false': 'View Fullscreen',
        'true': 'Exit Fullscreen'
    }
}));
      
    //  L.Control.geocoder().addTo(mymap);


	


	var popup = L.popup();
	
	
	function onMapClick()
	{
	controlBar.toggle();
	}

	function onMapdbClick(e) {
	    if (newMarker)
	     mymap.removeLayer(newMarker);
		 
		 
		 
		 
		  geocoder.reverse(e.latlng, mymap.options.crs.scale(mymap.getZoom()*2), function(results) {
          var r = results[0];
		  
		  //////////////////////////////////
		  pinpopup.setContent(pinpopupcontent);
		  newMarker = new L.marker(e.latlng,{draggable:true} ).addTo(mymap)
	    .bindPopup(pinpopup,{
  maxWidth: "auto"
}).openPopup();
		  
          if (r) {
          document.getElementById("adress").innerHTML=e.latlng+'\n'+r.name;	
   		  }
		  else
		  {
		  document.getElementById("adress").innerHTML=e.latlng;
		  }
		  
		   $(document).ready(function(){
   $("#ppp").popover({
        placement: 'bottom',
        html: 'true',
       // title : "<ul class='nav nav-tabs' id='navsurvey'><li class='active'><a data-toggle='tab' href='#menusurvey1' >Style</a></li><li><a href='#menusurvey2' data-toggle='tab' >Contrestyle</a></li></ul>",
       // content : " <div class='tab-content'><div id='menusurvey1' class='tab-pane fade in active'><input type='range'></input></br><input type='button' value='Next' onclick='' ></input></div><div id='menusurvey2' class='tab-pane fade'><p>Yooooooo</p></div></div><div class='btn-group'><button class='btn' id='prevtab' type='button'>Prev</button><button class='btn' id='nexttab' type='button'>Next</button></div>"
       content : "<div ><br><br><br> <input type='range' min='1000' max='10000' onchange='updateradius(this.value)' style='background-color:white;'><br><input type='time' id='appt' name='appt' min='9:00' max='18:00' required></div>",
	
	});
	$("#ppp").popover('show');
});
		  
		 newMarkerCircle = new L.circle(e.latlng, 40).addTo(mymap)
		
		
		
		 
newMarker.getPopup().on('remove', function() {
   mymap.removeLayer(newMarker);
   mymap.removeLayer(newMarkerCircle);

});
		/* newMarker._popup._closeButton.onclick = function( ){
         Dfunction();
         } */
		 
		 });
		
			
			}
mymap.on('click', onMapClick);
			
			
			
	mymap.on('dblclick', onMapdbClick);
	
	///////////////////// WE DONT DO LIKE THIS 
	
  /*        function Efunction(e,color) {
		  		//pinpopupcontent=pinpopupcontent+'</br>'+ e.innerHTML;
				document.getElementById("Title").innerHTML=e.innerHTML;
				///Collision detector here
				
				//pinpopupcontent+= '  <button onclick="Change()"> Change </button></br>' + '<input onclick="Description()"> Description </input></br>'+ '<button onclick="Pic()">Pic</button>'+'</br><button onclick="send()">Send</button>';
				
				var Icon = new L.Icon({
  iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-'+color+'.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

//pinpopup.setContent(pinpopupcontent);
newMarker.setIcon(Icon);
	           };
			   
			   function Ffunction() {
			   Collision();
			    newMarker = new L.marker(mymap.getCenter(),{icon: orangeIcon} ).addTo(mymap)
	    .bindPopup("<p>Street name</p><p>Garbages on the street</p><div  class='image'></div> <button> Add info</button> 54 <button> +1 </button><button> -1 </button>", {
  maxWidth: "auto"
}).openPopup();
	           };
			   
			    function Gfunction(e) {
		     pinpopupcontent='<h5>'+pinpopupcontent+'</h5>';
			 pinpopup.setContent(pinpopupcontent);
	           };
			   
			   
		  function Dfunction()
		  {
	 document.getElementById("nav").style.visibility='hidden';
	 
	           };
			   
			  function Collision()
			  {
	            alert('One event found close to you');
			 };
			 
			  var loadFile = function(event) {
    var output = document.getElementById('output');
    output.src = URL.createObjectURL(event.target.files[0]);
	
	
  };
  
  
 /* //Every 5 secondes we update la position des points 
  setInterval(function(){ 
//

  }, 10000);*/ 
  
 

  };
 };
 
 function Back(){
document.getElementById("viewDiv").style.display="none";
document.getElementById("menu1").style.display="block";
}

function init(){
var poll=['Emergency CASE:8979897','Police CASE:786878687','Halloween party','Delivery 76575676'];
var status=['list-group-item-danger','list-group-item-danger','','disabled'];
var creator=['EMS','Police Departement','Eloise','Amazon'];
 for (i = 0; i < poll.length; i++) {  
 var node = document.createElement("A");  
node.setAttribute("class", "list-group-item "+status[i]);  // Create a <li> node
node.setAttribute('id',"desactivate");
node.setAttribute('onclick','toggleConv(this)');
var titl = document.createElement("H4"); 
titl.setAttribute("class", "list-group-item-heading");
var tt = document.createTextNode(poll[i]); 
titl.appendChild(tt);      
var cr = document.createTextNode(creator[i]);
var li2 = document.createElement("p"); 
li2.setAttribute("class", "list-group-item-text");
li2.appendChild(cr);    

node.appendChild(titl);
node.appendChild(li2);

document.getElementById("poll2").appendChild(node);  
}

var poll=['Alex surpise birthday','Association meeting','Dentist RDV','Secret Appointement'];
var status=['list-group-item-info','list-group-item-success','disbabled','disabled'];
var creator=['Paul','John JinYu','Mr JKKKD','Masked'];
 for (i = 0; i < poll.length; i++) {  
 var node = document.createElement("A");  
node.setAttribute("class", "list-group-item "+status[i]);  // Create a <li> node
node.setAttribute("id", i);
node.setAttribute('onclick','');
var titl = document.createElement("H4"); 
titl.setAttribute("class", "list-group-item-heading");
var tt = document.createTextNode(poll[i]); 
titl.appendChild(tt);      
var cr = document.createTextNode(creator[i]);
var li2 = document.createElement("p"); 
li2.setAttribute("class", "list-group-item-text");
li2.appendChild(cr);    

node.appendChild(titl);
node.appendChild(li2);

document.getElementById("poll").appendChild(node);  
}



}

function activatedemo(){
 $('[href="#menu2"]').tab('show');
 Start();
 alert('Welcome in ARC Emergency Demo \n  \n 1.Activate your position \n 2.Confirm position or follow instructions \n 3. Fill out the questionnary. \n Thanks for your support.');
          
}

function showarrivaltime(e){
var Road = L.Routing.control({
    waypoints: [
        L.latLng(37.545877, 126.921235), //e
        L.latLng(37.546084, 126.922203)
    ]
})


/*
Road.on('routeselected', function (e) {
alert(Road._routes[0].summary.totalTime);
});

Road.on('routingerror', function (e) {
alert(e.message);
});*/
Road.addTo(mymap);
}

/*function Roadmap(e)
{
var request = new XMLHttpRequest();




var hospitallng=  '126.909769'; //'120.964790'; 
var hospitallat= '37.523164'; //'24.798140'; 


var geocoder = L.Control.Geocoder.nominatim(),
        control = L.Control.geocoder({
          geocoder: geocoder
        });
       
// Matching with the closest hospital or receive notification from the hospital
//geocoder.reverse(e,mymap.getZoom()*20, function(results) {
//          var r = results[0];
//		  if (r.name=='South Korea')
//		  { alert('fine'); hospitallng=  '126.909769'; hospitallat= '37.523164';}
		 
//         });


var string= "https://api.openrouteservice.org/v2/directions/driving-car?api_key=5b3ce3597851110001cf624879ebfcdd06524b60bd41133c5aa01fb1&start="+hospitallng+","+hospitallat+"&end="+e.lng+","+e.lat;
request.open('GET', string);

request.setRequestHeader('Accept', 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8');

request.onreadystatechange = function () {
  if (this.readyState === 4) {
  //  console.log('Status:', this.status);
  //  console.log('Headers:', this.getAllResponseHeaders());
   // console.log('Body:', this.responseText);
	 obj = JSON && JSON.parse(this.responseText) || $.parseJSON(this.responseText);
	 if(obj.features[0])
	 {
	 var setup=0;
	var mn = Math.trunc(Number(obj.features[0].properties.summary.duration)/60);
	var ss = Math.round(Number(obj.features[0].properties.summary.duration)%60);
	setInterval(function() {
	setup+=1;
	if (setup<9)
	document.getElementById('popuptxt').innerHTML='Information in validation... : '+setup+' sec' ;
	else{
	if (ss==0)
	{--mn;ss=60;}
	if (ss==0&&mn==0)
	document.getElementById('popuptxt').innerHTML='Arrival';
	--ss;
 document.getElementById('popuptxt').innerHTML='Information validated. </br> Estimated arrival time: '+mn+' min '+ss+' sec '; 
 document.getElementById('confirm').innerHTML='Please fill the survey'}
 document.getElementById('confirm').setAttribute('onclick','question(Number(0))');
 
}
, 1000);
  }}
 else{
 }
};

request.send();


}*/

function CalculateRoad(e)
{
var request = new XMLHttpRequest();




var hospitallng= '120.964790'; // '126.909769'; //; 
var hospitallat= '24.798140'; // '37.523164'; //


var geocoder = L.Control.Geocoder.nominatim(),
        control = L.Control.geocoder({
          geocoder: geocoder
        });
       
// Matching with the closest hospital or receive notification from the hospital
//geocoder.reverse(e,mymap.getZoom()*20, function(results) {
//          var r = results[0];
//		  if (r.name=='South Korea')
//		  { alert('fine'); hospitallng=  '126.909769'; hospitallat= '37.523164';}
		 
//         });


var string= "https://api.openrouteservice.org/v2/directions/driving-car?api_key=5b3ce3597851110001cf624879ebfcdd06524b60bd41133c5aa01fb1&start="+hospitallng+","+hospitallat+"&end="+e.lng+","+e.lat;
request.open('GET', string);

request.setRequestHeader('Accept', 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8');

request.onreadystatechange = function () {
  if (this.readyState === 4) {
  //  console.log('Status:', this.status);
  //  console.log('Headers:', this.getAllResponseHeaders());
   // console.log('Body:', this.responseText);
	 obj = JSON && JSON.parse(this.responseText) || $.parseJSON(this.responseText);
	 if(obj.features[0])
	 {
	 var setup=0;
	var mn = Math.trunc(Number(obj.features[0].properties.summary.duration)/60);
	var ss = Math.round(Number(obj.features[0].properties.summary.duration)%60);
	var dist = Number(obj.features[0].properties.summary.distance);
	document.getElementById('AT').innerText = mn+' min:'+ss+' sec';
		document.getElementById('DS').innerText = dist+ ' m';
  }}
 else{
 }
};

request.send();


}





 function question(e)
 {

 $(document).ready(function(){
   $("#confirm").popover({
        placement: 'bottom',
        html: 'true',
       // title : "<ul class='nav nav-tabs' id='navsurvey'><li class='active'><a data-toggle='tab' href='#menusurvey1' >Style</a></li><li><a href='#menusurvey2' data-toggle='tab' >Contrestyle</a></li></ul>",
       // content : " <div class='tab-content'><div id='menusurvey1' class='tab-pane fade in active'><input type='range'></input></br><input type='button' value='Next' onclick='' ></input></div><div id='menusurvey2' class='tab-pane fade'><p>Yooooooo</p></div></div><div class='btn-group'><button class='btn' id='prevtab' type='button'>Prev</button><button class='btn' id='nexttab' type='button'>Next</button></div>"
       title : "<input type = 'range' min='0' max='6' step='1' value='0' onchange='updatettl(this.value)'><br><p id='qtitle'>"+surveyttl[0]+"</p>",
	
	});
});
 }
 
 function updatettl(e)
 {
 document.getElementById('qtitle').innerHTML=surveyttl[e];
 }

 function showmenu2()
 {
  document.getElementById('eventnav').style.display='block';
 }
 
  function hidemenu2()
 {
  document.getElementById('eventnav').style.display='none';
 }
 
  function showmenu3()
{
markers[0].openPopup();
}
 
function toggleConv(conv)
{
var poll = document.getElementById('poll2');
var j = [...poll.children].indexOf(conv);
  //a.parentElement.setAttribute('style','background-color:#E8E8E8;')  Change the style of the active conversation
  //document.getElementById("arguments").setAttribute('class',"navbar navbar-fixed-top"); Maybe fix the div on the top
  
if (conv.id=='desactivate')
{
for (var i = 0; i < poll.children.length; i++)
{
if (i != j)
poll.children[i].style.display="none";
else
poll.children[i].setAttribute('id',"activate");
}
buildcontent(conv);
buildmap(this);
document.getElementById('backconv').style.display="block";
}



}

function backconv()
{
var poll = document.getElementById('poll2');
for (var i = 0; i < poll.children.length; i++)
{
if(poll.children[i].style.display="")
poll.children[i].setAttribute('id',"desactivate");
poll.children[i].style.display="";
}

document.getElementById('backconv').style.display="none";

//destroycontent()
$("#properties").empty();
$("#content").empty();  

//start to 
updateloc(0);

//destroymap()
 for (i=1;i<markers.length;i++)
 	mymap.removeLayer(markers[i]);


}


function buildcontent(a)
{
a.setAttribute('onclick','updateloc(1)');
var switchpos= document.createElement("INPUT");
switchpos.setAttribute('type','checkbox');
switchpos.setAttribute('data-toggle',"toggle");
var switcharr= document.createElement("INPUT");
switcharr.setAttribute('type','checkbox');
switcharr.setAttribute('data-toggle',"toggle");

document.getElementById('properties').appendChild(document.createTextNode("Show position"));
document.getElementById('properties').appendChild(switchpos);
document.getElementById('properties').appendChild(document.createTextNode("Show estimated arrival"));
document.getElementById('properties').appendChild(switcharr);

var content= document.createElement("DIV");

var opinion= document.createElement("P");
var opinioncontent='Im on my way!';
var posttime= document.createElement('span');
posttime.innerHTML='Posted 30/7 12:30 <br> ';

content.setAttribute('class','containertype pro');
//content.setAttribute('id','border-color:RGBA(0, 191, 255, 1)');
content.setAttribute('onclick','$(this).css("background-color",$(this).css("border-top-color"));updateloc(2);selectdiv(0)');

opinion.innerHTML=opinioncontent;
content.appendChild(opinion);
content.appendChild(posttime);

document.getElementById("content").appendChild(content); 

var content2= document.createElement("DIV");

var opinion= document.createElement("P");
var opinioncontent='Please fill the questionnary';
var posttime= document.createElement('span');
posttime.innerHTML='Posted 30/7 12:30 <br> ';

content2.setAttribute('class','containertype con');
//content2.setAttribute('style','border-color:blue');
content2.setAttribute('onclick','$(this).css("background-color",$(this).css("border-top-color"));updateloc(3);selectdiv(1)');

opinion.innerHTML=opinioncontent;
content2.appendChild(opinion);
content2.appendChild(posttime);

document.getElementById("content").appendChild(content2); 

var content3= document.createElement("DIV");
content3.setAttribute('class','containertype neutral');
content3.innerHTML="<input type = 'range' min='0' max='6' step='1' value='0' onchange='updatettl(this.value)'><br><p id='qtitle'>"+surveyttl[0]+"</p>";
content3.setAttribute('onclick','selectdiv(2)');
document.getElementById("content").appendChild(content3); 

var content4= document.createElement("DIV");
content4.setAttribute('class','containertype green');
content4.innerHTML="WUWU joined the chat";
content4.setAttribute('onclick','$(this).css("background-color",$(this).css("border-top-color"));selectdiv(3);updateloc(0)');
document.getElementById("content").appendChild(content4); 

}

function buildmap()
{
var event1  = new L.circle([37.544097, 126.95053], 20)
guest1 = L.circle([37.523164, 126.909769],20).setStyle({
    color: 'blue',
});
 guest2    = L.circle([39.74, -104.99,20]).setStyle({
    color: 'pink',
});
 
 markers.push(event1);
 markers.push(guest1);
 markers.push(guest2);
 
 for (i=1;i<markers.length;i++)
 	mymap.addLayer(markers[i]);
	
	
	
	
	//activemarker = L.layerGroup(markers);
	//mymap.addLayer(activemarker);
}


/*How to check if a marker is open
var popup = marker.getPopup(); // returns marker._popup

console.log(popup._isOpen); // true or false
*/



function updateloc(nb)
{
mymap.closePopup();
customPopup='<div><h5>Distance:<p id="DS">unknown<p> <br>  Estimated arrival time: <p id="AT">unknown<p> </h5></div>';
 customOptions=
        {
        'className' : '',
				autoClose:false,
    closeOnClick:false
        };
		
markers[nb].bindPopup(customPopup,customOptions).openPopup();

 var latLngs = [ markers[nb].getLatLng() ];
  var markerBounds = L.latLngBounds(latLngs);
  mymap.fitBounds(markerBounds);
  CalculateRoad(markers[nb].getLatLng());

}


/* Math function to calculate the distance in meter between 2 gps coordinates */

function degreesToRadians(degrees) {
  return degrees * Math.PI / 180;
}

function distanceInMBetweenEarthCoordinates(lat1, lon1, lat2, lon2) {
  var earthRadiusKm = 6371;

  var dLat = degreesToRadians(lat2-lat1);
  var dLon = degreesToRadians(lon2-lon1);

  lat1 = degreesToRadians(lat1);
  lat2 = degreesToRadians(lat2);

  var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
          Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  return (earthRadiusKm * c)*1000;
}

 function updateradius(val)
{
if(newMarkerCircle)
mymap.removeLayer(newMarkerCircle);
newMarkerCircle= new L.circle(newMarker.getLatLng(),val*1).addTo(mymap)
}

function selectdiv(e)
{
for (i=0;i<document.getElementById('content').childNodes.length;i++)
   if (i!=e)
 	document.getElementById('content').childNodes[i].style.backgroundColor='';

}



</script>





<div class="tab-content">
 <div id="menu1" class="tab-pane fade in active" style='text-align:center' >

 
 <h2> JK </h2>
 <br>
 <h4> phone number </h4>
 <br>
 <br>
 <button> Parameters </button>
 <br>
 <a href='#'> LogOut<a>
 
 </br>
 </br>
 </br>
 </br> 

  <div id="message"/>
  </div>
  
  

</div>


 
 
<div id="inboxxx" class="center overlay" style='display:none;' data-backdrop="false">
  <div class="ftp" > 

</div>
<div id='menu' class='menu' >
<button onclick='backconv()' id='backconv' style='display:none'>back</button>
<div class='list-group' id='poll2'></div>
<div id='properties'></div><div id='content'></div>
  </div>
 </div>
  
<div id="nav1" class="up overlay" style='text-align:center' data-backdrop="false">
<ul class="nav">
    <button class="btn btn-secondary" href="#menu1"> <a  onclick="Back()" id="back" data-html="true"  data-toggle="popover" title="Source" data-placement="top" data-trigger="focus"
	  data-popover-content="#unique-id" ><span class="glyphicon glyphicon-user" ></span> JK</a></button>
	 
	 
  <button   id="maintitle" onclick="Start()" type="button" class="btn btn-secondary">
    Start
  </button>
   <button  class="btn btn-secondary dropdown-toggle dropup" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
 <span class="glyphicon glyphicon-envelope"></span>
</button>
<button class="btn btn-secondary"><span id='connectstatus' ></span></button>
</li>
  <li>
  <div class="btn-group dropup" style='display:none' id='inbox' >
     <span class="glyphicon glyphicon-inbox"></span>
	<span class="badge type">3</span>
  </button>
  <div  class="dropdown-menu navsub">
   <p> Create a new event!</p> <button onclick='showmenu3()'>+</button>
     <div class="list-group" id="poll" onclick='activatedemo()'> </div>
  </div>
  </div>
  </li>
 
	
	 
    </ul>
</div>
 

  





</body>

`<script>

 var $tabs = $('#navsurvey').children();

$('#prevtab').on('click', function() {
    $tabs.filter('.active').prev('li').find('a[data-toggle="tab"]').tab('show');
});

$('#nexttab').on('click', function() {
    $tabs.filter('.active').next('li').find('a[data-toggle="tab"]').tab('show');
});

/*
Comment creer un evenement? Double clique sur la map : [Add event +] : Add people or phone number and Select personne tout follow if there is and validate the fix adress. 

Pas dans l'evenement backgroud-color white, border color, 


















*/

Start();


</script>
</html>